<?php
/**********************************

# Byxx'CMS v1.02! 
# AUTEUR: Nicow
# DESIGN & CSS: Nicow
# CODE & PHP: Nicow
# AIDEMU: www.aidemu.fr
# CONTACT: in.fer.no74@hotmail.fr

**********************************/
?>
<?php
function secu($var)
{
	//$var = htmlentities( trim( $var, " \0" ), ENT_NOQUOTES );
    //$var = mysql_real_escape_string( $var );
    return mysql_real_escape_string(htmlspecialchars($var));
}

function numtable($table)
{
$query = 'SELECT id FROM ' . $table . ' ORDER BY id DESC;';
$sql = mysql_query($query) or die(''.$query.'<br />'.mysql_error());
return mysql_num_rows($sql);
}

function numtable2($table)
{
$query = 'SELECT guid FROM ' . $table . ' ORDER BY guid DESC;';
$sql = mysql_query($query) or die(''.$query.'<br />'.mysql_error());
return mysql_num_rows($sql);
}

function statut($IP, $PORT)
{ if (@fsockopen($IP, $PORT, $ERRNO, $ERRSTR, 0.5 )){ $statut = TRUE; }
else
{ $statut = FALSE; }
@fclose();
return $statut;
}

function getinfo($LOGIN, $INFO)
{
$query = "SELECT * FROM accounts WHERE account = '". $LOGIN ."'";
$data = mysql_fetch_array(mysql_query($query));
return $data[''. $INFO .''];
}

function getnewsinfo($ID, $INFO)
{
$query = "SELECT * FROM live_news WHERE id = '". $ID ."'";
$data = mysql_fetch_array(mysql_query($query));
return $data[''. $INFO .''];
}

function getpersoinfo($ID, $INFO)
{
$query = "SELECT * FROM personnages WHERE guid= '". $ID ."'";
$data = mysql_fetch_array(mysql_query($query));
return $data[''. $INFO .''];
}

function wichClass($idClass)
{
	switch($idClass){
		case 1:
			$classe = "<img src='style/img/heads/feca.png'>";
			break;
		case 2:
			$classe = "<img src='style/img/heads/osa.png'>";
			break;
		case 3:
			$classe = "<img src='style/img/heads/enu.png'>";
			break;
		case 4:
			$classe = "<img src='style/img/heads/sram.png'>";
			break;
		case 5:
			$classe = "<img src='style/img/heads/xel.png'>";
			break;
		case 6:
			$classe = "<img src='style/img/heads/eca.png'>";
			break;
		case 7:
			$classe = "<img src='style/img/heads/eni.png'>";
			break;
		case 8:
			$classe = "<img src='style/img/heads/iop.png'>";
			break;
		case 9:
			$classe = "<img src='style/img/heads/cra.png'>";
			break;
		case 10:
			$classe = "<img src='style/img/heads/sadi.png'>";
			break;
		case 11:
			$classe = "<img src='style/img/heads/sacri.png'>";
			break;
		case 12:
			$classe = "<img src='style/img/heads/pand.png'>";
			break;
	}
	return $classe;
}

function wichAlign($classe)
{
	switch($classe){
		case 0:
			$classe = "Neutre";
			break;
		case 1:
			$classe = "<span style='color:#2384ff;'>Bontarien</span>";
			break;
		case 2:
			$classe = "<span style='color:#c90f00;'>Brakmarien</span>";
			break;
		case 3:
			$classe = "<span style='color:#a97a62;'>Mercenaire</span>";
			break;
	}
	return $classe;
}


function wichClassImg($classImg)
{
	switch($classImg){
		case 1:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/fec.png'>";
			break;
		case 2:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/osa.png'>";
			break;
		case 3:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/enu.png'>";
			break;
		case 4:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/sra.png'>";
			break;
		case 5:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/xel.png'>";
			break;
		case 6:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/eca.png'>";
			break;
		case 7:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/eni.png'>";
			break;
		case 8:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/iop.png'>";
			break;
		case 9:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/cra.png'>";
			break;
		case 10:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/sad.png'>";
			break;
		case 11:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/sac.png'>";
			break;
		case 12:
			$classe = "<img style='position:absolute;margin-top:53px;margin-left:272px;' src='style/img/class/pan.png'>";
			break;
	}
	return $classe;
}

function deletePerso($idPerso)
{
		$queryVerif = TRUE;
		$index = 1;
		$retour = mysql_query("SELECT objets FROM personnages WHERE guid=".$idPerso."");
		$donnees = mysql_fetch_array($retour);
		$objetArray = preg_split('[\|]',$donnees['objets']);
		
		if(mysql_num_rows($retour) != 0)
		{
			if($donnees['objets'] != "")
			{
				while($objet = $objetArray[$index] AND $queryVerif == TRUE)
				{
					$queryVerif = mysql_query("DELETE FROM items WHERE guid=".$objet."");
					$index +=1;
				}
			}
			$queryVerif = mysql_query("DELETE FROM personnages WHERE guid=".$idPerso."");
		}
		
		if ($queryVerif == FALSE)
		{
			return FALSE;
		}
		else
		{
			return TRUE;
		}
}

function deleteAccount($idAccount)
{
	/*Declaration variables*/
	$queryVerif = TRUE;
	$index = 1;
	$idPerso = NULL;
	$persoDel = TRUE;	
	/* FIN */
	
	$accDel = mysql_query("DELETE FROM accounts WHERE guid=".$idAccount."");
	$retourPerso = mysql_query("SELECT guid FROM personnages WHERE account=".$idAccount."");
	
	if (mysql_num_rows($retourPerso) != 0)
	{
		while($accDel == TRUE AND $persoDel == TRUE AND $donneesPerso = mysql_fetch_array($retourPerso))
		{
			$persoDel = deletePerso($donneesPerso['guid']);
			$index += 1;
		}
	}
	if ($accDel == TRUE AND $persoDel == TRUE)
	{
		return TRUE;
	}
	else
	{
		return FALSE;
	}
		
}

function isMine($idPerso, $nomAccount) //Retourne TRUE si le personnages appartient au compte $idAccount
{
	$idPerso = secu($idPerso);
	$nomAccount = secu($nomAccount);
	
	$retour = mysql_query("SELECT * FROM personnages WHERE guid=".$idPerso."");
	$donneesPerso = mysql_fetch_array($retour);
	
	$retour = mysql_query("SELECT * FROM accounts WHERE account='".$nomAccount."'");
	$donneesAccount = mysql_fetch_array($retour);
	$idAccount = $donneesAccount['guid'];
	
	if($donneesPerso['account'] == $idAccount)
	{
		return TRUE;
	}
	else
	{
		return FALSE;
	}
}

function nomPerso($idPerso)
{
	$idPerso = secu($idPerso);
	$retour = mysql_query("SELECT * FROM personnages WHERE guid='".$idPerso."'");
	$donnees = mysql_fetch_array($retour);
	$nomPerso = $donnees['name'];
	
	return $nomPerso;
}

function nomAccount($idAccount)
{
	$idAccount = secu($idAccount);
	
	$nomAccount = mysql_fetch_array(mysql_query("SELECT * FROM accounts WHERE guid=".$idAccount.""));
	$nomAccount = $nomAccount['account'];
	
	return $nomAccount;
}

function getinfoPerso($idPerso, $wanted)
{
	$retour = mysql_query("SELECT * FROM personnages WHERE guid=".$idPerso."");
	$donnees = mysql_fetch_array($retour);
	
	return $donnees[''.$wanted.''];
}
?>