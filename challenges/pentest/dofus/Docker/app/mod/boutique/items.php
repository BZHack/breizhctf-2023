<?php
/**********************************

# Byxx'CMS v1.01! 
# AUTEUR: Nicow
# DESIGN & CSS: Nicow
# CODE & PHP: Nicow
# AIDEMU: www.aidemu.fr
# CONTACT: in.fer.no74@hotmail.fr

# REMERCIMENT A DOELIA POUR SA BOUTIQUE DE L'ANCIEN SERVEUR PLOWS (Modifier par moi) !

**********************************/
?>
<?php
class Item
{
	public function __construct($id)
	{
		$rep = mysql_fetch_array(mysql_query("SELECT * FROM byxx_boutique WHERE ID='$id'"));
		$don = mysql_fetch_array(mysql_query("SELECT * FROM item_db WHERE id='".$rep['idItem']."'"));

		$this->ID = $rep['ID'];
	  	$this->type = $rep['type'];
		$this->idItem = $rep['idItem'];

		if (empty($rep['swf']))
		{
			if ($don['GfxId'] < 100){if ($don['GfxId'] < 10){$zero = "00";} else {$zero = "0";}} else {$zero = "";}
			$file = $don['Type'].$zero.$don['GfxId'].".swf";
			$this->swf = $file;
		}
		else $this->swf = $rep['swf'].'.swf';

		if (empty($rep['name'])) $this->name = $don['Name'];
		else $this->name = $rep['name'];

		$this->level = $don['Level'];
	  	$this->stats = $rep['stats'];
	  	$this->cout = $rep['cout'];

	}

	public function buy($idPerso)
	{
		$nbrAchats = mysql_num_rows(mysql_query("SELECT ID FROM live_action"));

		if ($nbrAchats > 250)
			return 6;
		else
		{
			$infosPerso = new Perso($idPerso);
			$infosCompte = new Compte($infosPerso->account);
			if ( ($infosCompte->guid != $infosPerso->account) || ($infosPerso->guid != $idPerso) )
			return 5;

			if ($infosCompte->points < $this->cout)
			return 2;
			else
			{
				$idItem = $this->idItem;
				/*
				if (@fsockopen('217.160.6.179', 444, $ERRNO, $ERRSTR, 3) == FALSE)
				return 3; // Erreur de connexion a l'ému
				*/

				// if (@$sock = fsockopen('217.160.6.179', 5556, $ERRNO, $ERRSTR, 3)) // Test du port des actions + connexion au socket
				if (true)
				{
					$infosCompte->modifPoints(-($this->cout));
					switch($this->type)
					{
						case 0:
						case 1:
						case 2:
						case 3:
						case 4:
						case 5:
						mysql_query("INSERT INTO `live_action` (`PlayerID`, `Action`, `Nombre`) VALUES ('$idPerso', '21', '$idItem')");
						break;
					}
					return 1;
				}
				else return 4;
			}
		}

	}
}
