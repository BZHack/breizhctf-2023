<?php
/**********************************

# Byxx'CMS v1.02! 
# AUTEUR: Nicow
# DESIGN & CSS: Nicow
# CODE & PHP: Nicow
# AIDEMU: www.aidemu.fr
# CONTACT: in.fer.no74@hotmail.fr

# REMERCIMENT A DOELIA POUR SA BOUTIQUE DE L'ANCIEN SERVEUR PLOWS (Modifier par moi) !

**********************************/
?>
<?php 
echo'<center><img src='.$ban_boutique.'></center>' ;
	echo'<img style="background-color:#2f2f2f" src="style/img/topContent.png">' ;
		echo'<div id="bgContent">' ;
			echo'<div id="textContent">' ;
			echo'<table style="margin:auto;">' ;
			echo'<td><a href="'.$lien_boutique.'1"><img class="aImg" title="Equipements" width="80" style="background-color:#2f2f2f" src="style/img/boutique/1.png"></a></td>' ;
			echo'<td><a href="'.$lien_boutique.'2"><img class="aImg" title="Dofus" width="80" style="background-color:#2f2f2f" src="style/img/boutique/2.png"></a></td>' ;
			echo'<td><a href="'.$lien_boutique.'3"><img class="aImg" title="Armes" width="80" style="background-color:#2f2f2f" src="style/img/boutique/3.png"></a></td>' ;
			echo'<td><a href="'.$lien_boutique.'4"><img class="aImg" title="Familiers" width="80" style="background-color:#2f2f2f" src="style/img/boutique/4.png"></a></td>' ;
			echo'<td><a href="'.$lien_boutique.'5"><img class="aImg" title="Divers & Autres" width="80" style="background-color:#2f2f2f" src="style/img/boutique/5.png"></a></td>' ;
			echo'</table>' ;
			echo'</div>' ;
		echo'</div>' ;
	echo'<img style="background-color:#2f2f2f" src="style/img/bottomContent.png">' ;			
	echo'<img style="background-color:#2f2f2f" src="style/img/topContent.png">' ;
		echo'<div id="bgContent">' ;
			echo'<div id="textContent">' ;				

	$repListePerso = mysql_query("SELECT guid FROM personnages WHERE account = '".$compte->guid."' ORDER BY level DESC");
	for ($i=0; $donListePerso = mysql_fetch_array($repListePerso); $i++)
	$perso[$i] = new Perso($donListePerso[0]);
	$nbrPerso = mysql_num_rows($repListePerso);
if (isset($_GET['objet']) && is_numeric($_GET['objet']))
{
	$error = FALSE;
	if (!$connect) $error = 1;
	if (!$error)
	{
		$rep = mysql_fetch_array(mysql_query("SELECT ID FROM byxx_boutique WHERE ID='".$_GET['objet']."'"));
		if (!isset($rep[0])) $error = 2;
	}
	if (!$error)
	{
		$item = new Item($rep[0]);
		if ($compte->points < $item->cout) $error = 3;
	}
	if (!$error)
	{
		if (isset($_POST['persoSelect']))
		{
			$error = 99;
			$result = $item->buy($perso[$_POST['persoSelect']]->guid);
		}
	}
	if (!$error)
	{
	
echo '<center><b>Vous êtes sur le point d\'acheter l\'item :</b></center>';
echo '<br/>';
			 echo '<div id="moduleBoutique_achat">';
			 echo '<span style="font-size:12px;position:absolute;margin-top:25px;margin-left:30px;">'.$item->name.'</span>';
			 echo '<span style="font-size:12px;position:absolute;margin-top:52px;margin-left:185px;">Coût : <b>'.$item->cout.'</b></span>';
			 echo '<span style="font-size:12px;position:absolute;margin-top:52px;margin-left:310px;">Niveau : <b>'.$item->level.'</b></span>';
			 echo '<span style="font-size:10px;position:absolute;margin-top:79px;margin-left:187px;">'.$item->stats.'</span>';
			 echo '<span style="position:absolute;margin-top:25px;margin-left:390px;"> ';
			 echo '<a target="blank" href="style/swf/boutique/swf/'.$item->swf.'"><img title="Zoomer l\'item" class="devtoolIcon" src="style/img/devtool/zoom.png"></a>';
			 echo '</span>';
			 echo '<object style="position:absolute;margin-top:51px;margin-left:28px;"width="145px;" height="145px" type="application/x-shockwave-flash" data="style/swf/boutique/swf/'.$item->swf.'">';
			 echo '<param name="movie" value="style/swf/boutique/swf/'.$item->swf.'" /><param name="wmode" value="transparent" />';
			 echo '</object>';
			 echo '</div>';  
?>
		<span style="color: rgb(255, 0, 0)">ATTENTION : Vous devez impérativement avoir votre personnage connecté au jeu avant de valider la commande.</span><br><br>
		Aucun remboursement ne pourra avoir lieu en cas de perte si vous ne respectez pas cette indication.<br>
		Veuillez vérifier maintenant que vous n'avez pas été déconnecté du jeu avant de faire l'achat.<br><br>
		Pour confirmer, selectionnez le personnage <b>connecté</b> sur lequel vous voulez recevoir votre achat :<br><br>

		<?php if ($nbrPerso > 0) { ?>
		<center><form method="POST" action="">
		<select style="width:200px" class="input" name="persoSelect" class="champLong">
		<?php
		for ($i=0; $i < $nbrPerso; $i++)
		{
			?><option value="<?php echo $i; ?>"><?php echo $perso[$i]->name; ?></option><?php
		}
		?>
		</select>
		<input type="hidden" name="obj" value="<?php echo $_GET['objet']; ?>">
		<input class="input" type="submit" value="Confirmer">
		</form></center>

		<?php } else echo "Aucun personnage sur ce compte";
	}
	if ($error)
	{
		switch ($error)
		{
			
			case 1: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Vous devez être connecté</div>"; break;
			case 2: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Objet introuvable</div>"; break;
			case 3: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Pas assez de points</div>"; break;
			case 6: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Trop de commandes sont en cours, veuillez réésayer plus tard.</div>"; break;
			case 99:

			switch ($result)
			{
			
				case 1: echo '<div class="verifOK"><img class="devtoolIcon" src="style/img/devtool/infos.png"> Transaction effectuée avec succés, vous devrez recevoir votre commande dans les quelques minutes qui suivent...</div><br>
				<span style="color: rgb(255, 0, 0)">IMPORTANT : Afin de valider totalement votre commande,<br>
				il est impératif de deconnecter / reconnecter votre personnage afin de sauvegarder votre achat après l\'avoir reçus.</span><br>
				Les pertes suites au reboots sont rarements rendus faute de preuves, donc merci de suivre notre conseil.
				'; break;
				case 2: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Vous n'avez pas assez de points.</div>"; break;
				case 3: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Emulateur non connecté.</div>"; break;
				case 4: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Connexion à la reception des commandes échouée.</div>"; break;
				case 5: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Erreur : Atribution de personnage échouée.</div>"; break;
				case 6: echo "<div class='verifNO'><small><img class='devtoolIcon' src='style/img/devtool/error.png'>Trop de commandes sont en cours, veuillez réésayer plus tard.</div>"; break;
			}

			break;
		}
	}

}
else
{
echo "Aucun objet séléctionné";
}
?>
			</div>
		</div>
	<img style="background-color:#2f2f2f" src="style/img/bottomContent.png">
