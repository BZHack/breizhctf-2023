<?php
/**********************************

# Byxx'CMS v1.02! 
# AUTEUR: Nicow
# DESIGN & CSS: Nicow
# CODE & PHP: Nicow
# AIDEMU: www.aidemu.fr
# CONTACT: in.fer.no74@hotmail.fr

**********************************/
?>

<center><img src="<?php echo $ban_change_name ; ?>"></center>
	
	<img style="background-color:#2f2f2f" src="style/img/topContent.png">
		<div id="bgContent">
			<div id="textContent">		

<?php
if(isset($_SESSION['login']) AND isset($_SESSION['level']))
	{ 
		$donnees = mysql_fetch_array(mysql_query("SELECT * FROM accounts WHERE account = '".secu($_SESSION['login'])."'"));
		$login = $_SESSION['login'];
		$point = getinfo($_SESSION['login'], "points");
		$retour = mysql_query('SELECT personnages.* FROM personnages,accounts WHERE accounts.account="'.secu($_SESSION['login']).'" AND personnages.account=accounts.guid ORDER BY personnages.level DESC');
		$cout = $change_name_cout;
		$repListePerso = mysql_query("SELECT guid FROM personnages WHERE account = '".$compte->guid."' ORDER BY level DESC");
		for ($i=0; $donListePerso = mysql_fetch_array($repListePerso); $i++)
		$perso[$i] = new Perso($donListePerso[0]);
		$nbrPerso = mysql_num_rows($repListePerso);
		if ($nbrPerso > 0) {
		$ok = FALSE;
		$ok_2 = FALSE;
		$change_name = TRUE;
if(isset($_POST['ok']))
	{
$name = mysql_real_escape_string(htmlspecialchars(trim($_POST['news_name']) ) );
$sql1 = 'SELECT * FROM personnages WHERE name="'.$name.'"';
$req1 = mysql_query($sql1) or die('SQL Error !<br>'.$sql1.'<br>'.mysql_error());
$data1 = mysql_fetch_array($req1);
if($data1['name'] == $name){
	echo "<div class='verifNO'><img class='devtoolIcon' src='style/img/devtool/error.png'> Le nom de personnages soumis existe déjà !</div><br>";
}
else
{
    $_GET['change_name']  = addslashes($_GET['change_name']);
	$mapid = $D_map;
	$cellid = $D_cell;
			$sql = "UPDATE personnages SET name='" . secu($_POST['news_name']) . "' WHERE guid='" . secu($_POST['persoselect']) . "'";
			mysql_query($sql) or die('Erreur SQL !'.$sql.'<br />'.mysql_error());
			$ok = TRUE;
			$ok_2 = "<div class='verifOK'><img class='devtoolIcon' src='style/img/devtool/infos.png'> Bravo, tu viens de modifier le nom de ton personnages !</div>";
			mysql_query("UPDATE accounts SET points = points - $cout WHERE guid = '".$compte->guid."'");
			$change_name = FALSE;
	}
}
?>
<?php if($ok == TRUE) { echo '' .  $ok_2. ''; } ?>
<?php if($change_name == TRUE){?>
<center>
Marre de votre nom de personnage pourrit ?!<br><br>
Marre de qu'on vous appelle le noob ?!<br><br>
Alors n'attend plus, viens changer votre nom de personnage pour la maudique somme de <b><?php echo $cout ; ?></b> points boutiques !<br><br>
</center>
<?php if ($point < $cout) 
	{
	echo "<div class='verifNO'><img class='devtoolIcon' src='style/img/devtool/error.png'> Tu ne possèdes pas assez de points sur ton compte pour utiliser ce module !</div>";
	}
else
	{ 
?>
<table style="width: 605px" border="0">
<br>
<form action="index.php?page=change_name&amp;change_name=" method="post">
<center>
<table width="100%" border="0">
<tr>
<td>
<select style="width:100%;" class="input" name="persoselect">
<?php
for ($i=0; $i < $nbrPerso; $i++)
{
?><option label="<?php echo $perso[$i]->name; ?>" value="<?php echo $perso[$i]->guid; ?>"><?php echo $perso[$i]->name; ?></option><?php
}
?>nts
</select>
</td>
<td>
<input class="input" style="width:100%;" type="texte" name="news_name" value="Nouveaux nom"  onfocus="this.value=''">	
</td>
<td>
<input class="input" style="width:100%;" type="submit" name="ok" value="Je confirme la modification">		
</td>
</tr>
 </table>
 </form>
 <br><div class='verifNO'><img class='devtoolIcon' src='style/img/devtool/error.png'> Attention, tu dois obligatoirement être déconnecté du jeux avant d'utiliser ce module !</div>
<?php } ?>
<?php } else { echo ''; } ?>
<?php } else { echo "<div class='verifNO'><img class='devtoolIcon' src='style/img/devtool/error.png'> Aucun personnage sur ce compte !</div>"; } ?>
<?php } else { echo "<div class='verifNO'><img class='devtoolIcon' src='style/img/devtool/error.png'> Vous devez être connecté pour changer le nom d'un personnage !</div>"; } ?>
			</div>
		</div>
	<img style="background-color:#2f2f2f" src="style/img/bottomContent.png">
