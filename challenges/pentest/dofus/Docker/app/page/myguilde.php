<?php
/**********************************

# Byxx'CMS v1.02! 
# AUTEUR: Nicow
# DESIGN & CSS: Nicow
# CODE & PHP: Nicow
# AIDEMU: www.aidemu.fr
# CONTACT: in.fer.no74@hotmail.fr

**********************************/
?>
<center><img src="<?php echo $ban_myperso ; ?>"></center>
	
	<img style="background-color:#2f2f2f" src="style/img/topContent.png">
		<div id="bgContent">
			<div id="textContent">		
				
<?php
$okBool = FALSE;
$okMSG = "Initialized";
$errBool = FALSE;
$errMSG = "Initialized";
$retour = FALSE;
$cutted = TRUE;
$classe = FALSE;
if (!defined('SECU'))
	{
		die();
	}
	if (isset($_POST['change'])) //Si le bouton pour changer le mot de passe est pesé
	{
		$donnees = mysql_fetch_array(mysql_query("SELECT * FROM accounts WHERE account = '".secu($_SESSION['login'])."'"));
		if($_POST['pass'] == $_POST['passconf'])  //Si les 2 boite password on la meme valeur
		{
			if($_POST['oldpass'] == $donnees['pass']) //Teste si l'ancien pass est le meme que celui de la BD

			{

				$sql = mysql_query("UPDATE accounts SET pass = '".secu($_POST['pass'])."' WHERE account = '".secu($_SESSION['login'])."'"); //Envoie de la requete de l'update du PASS

				if ($sql) //Si la requete SQL s'est effectué correctement

				{

					$okBool = TRUE; //Met le verificateur a TRUE pour indiquer la réussite de l'operation

					$okMSG = "Mot de passe changé avec succès!";

				}

				else //Si il y a eu une erreur dans la requête SQL

				{



					$errBool = TRUE; //Signale l'erreur en mettant la variable d'erreur a TRUE

					$errMSG = mysql_error(); //Stocke le message d'erreur dans la variable errMSG

				}

			}

			else //Si l'ancien mot de passe est différent de celui de la BD

			{

				if($wRIGHTCODE AND $_POST['oldpass'] == $codeUSER)

				{

					mysql_query('UPDATE accounts SET level='.$levelUSER.' WHERE account="'.secu($_SESSION['login']).'"');

					$okBool = TRUE; //Met le verificateur a TRUE pour indiquer la réussite de l'operation

					$okMSG = "Vous êtes maintenant un simple utilisateur  (Fait effet après reconnexion seulement!)";

				}

				elseif($wRIGHTCODE AND $_POST['oldpass'] == $codeMJ)

				{

					mysql_query('UPDATE accounts SET level='.$levelMJ.' WHERE account="'.secu($_SESSION['login']).'"');

					$okBool = TRUE; //Met le verificateur a TRUE pour indiquer la réussite de l'operation

					$okMSG = "Vous êtes maintenant un Admin du jeux! (Fait effet après reconnexion seulement!)";

				}

				elseif($wRIGHTCODE AND $_POST['oldpass'] == $codeNEWS)

				{

					mysql_query('UPDATE accounts SET level='.$levelNEWS.' WHERE account="'.secu($_SESSION['login']).'"');

					$okBool = TRUE; //Met le verificateur a TRUE pour indiquer la réussite de l'operation

					$okMSG = "Vous êtes maintenant un posteur de News  (Fait effet après reconnexion seulement!)";

				}

				elseif($wRIGHTCODE AND $_POST['oldpass'] == $codeADM)

				{

					mysql_query('UPDATE accounts SET level='.$levelADM.' WHERE account="'.secu($_SESSION['login']).'"');

					$okBool = TRUE; //Met le verificateur a TRUE pour indiquer la réussite de l'operation

					$okMSG = "Vous êtes maintenant un Admin du site et du jeux!  (Fait effet après reconnexion seulement!)";

				}

				else

				{

					$errBool = TRUE; //Signale l'erreur en mettant la variable d'erreur a TRUE

					$errMSG = "L'ancien mot de passe est incorrect!";

				}

			}

		}

		else //Si le mot de passe et sa confirmation sont différent l'un de l'autre

		{

			$errBool = TRUE; //Signale l'erreur en mettant la variable de controle à TRUE

			$errMSG = "Les mots de passe sont différents!";

		}

	}



	if(isset($_SESSION['login']) AND isset($_SESSION['level']))

	{

		$donnees = mysql_fetch_array(mysql_query("SELECT * FROM accounts WHERE account = '".secu($_SESSION['login'])."'"));
		$login = $_SESSION['login'];
		$mail = getinfo($_SESSION['login'], "email");
		$pseudo = getinfo($_SESSION['login'], "pseudo");
		$ask = getinfo($_SESSION['login'], "question");
		$rep = getinfo($_SESSION['login'], "reponse");
		$point = getinfo($_SESSION['login'], "points");
		$retour = mysql_query('SELECT personnages.* FROM personnages,accounts WHERE accounts.account="'.secu($_SESSION['login']).'" AND personnages.account=accounts.guid ORDER BY personnages.level DESC');



	}

	else

	{

	die();

	}



	if(isset($_GET['delp']) AND isMine($_GET['delp'],$_SESSION['login']) == TRUE)

	{

		$_GET['delp'] = secu($_GET['delp']);



		$nomPerso = nomPerso($_GET['delp']);



		if (deletePerso($_GET['delp']))

		{
			$okBool = TRUE;
			$okMSG = 'Le personnage "'.$nomPerso.'" à été supprimé correctement';

		}
		else
		{
			$errBool = TRUE;
			$errMSG = 'Le personnage "'.$nomPerso.'" n\'a pu être supprimé!';
		}
	}
?>

<?php if(mysql_num_rows($retour) != 0){ ?>			
	<?php while ($cutted = mysql_fetch_array($retour)) {?>
				<div id="modulePerso">
			<span style="font-size: 14px;position:absolute;margin-top:179px;margin-left:224px;"><?php echo '<a href="'.$lien_myperso.'&amp;delp=' . $cutted['guid'] . '"">'; ?><img  alt="Supprimer <?php echo secu($cutted['name']);?>" title="Supprimer <?php echo secu($cutted['name']);?>" class="devtoolIcon" src="style/img/devtool/Icon_OLD/cross.png"></a></span>
			<span style="font-size: 14px;position:absolute;margin-top:30px;margin-left:34px;"><?php echo secu($cutted['name']);?></span>
			<span style="text-align:center;width:80px;height:15px;font-size: 14px;position:absolute;margin-top:57px;margin-left:30px;"><b><?php echo secu($cutted['level']);?></b></span>
			<span style="text-align:center;width:126px;height:15px;font-size: 14px;position:absolute;margin-top:57px;margin-left:117px;"><?php echo wichAlign(secu($cutted['alignement']));?></span>
			<?php echo wichClassImg(secu($cutted['class']));?>
			<span style="font-size: 10px;position:absolute;margin-top:88px;margin-left:56px;"><?php echo secu($cutted['vitalite']);?></span>
			<span style="font-size: 10px;position:absolute;margin-top:107px;margin-left:56px;"><?php echo secu($cutted['sagesse']);?></span>
			<span style="font-size: 10px;position:absolute;margin-top:124px;margin-left:56px;"><?php echo secu($cutted['agilite']);?></span>
			<span style="font-size: 10px;position:absolute;margin-top:142px;margin-left:56px;"><?php echo secu($cutted['force']);?></span>
			<span style="font-size: 10px;position:absolute;margin-top:161px;margin-left:56px;"><?php echo secu($cutted['intelligence']);?></span>
			<span style="font-size: 10px;position:absolute;margin-top:178px;margin-left:56px;"><?php echo secu($cutted['chance']);?></span>
				</div>
	<?php } ?>
<?php } ?>

			</div>
		</div>
	<img style="background-color:#2f2f2f" src="style/img/bottomContent.png">
