<?php
/**********************************

# Byxx'CMS v1.02! 
# AUTEUR: Nicow
# DESIGN & CSS: Nicow
# CODE & PHP: Nicow
# AIDEMU: www.aidemu.fr
# CONTACT: in.fer.no74@hotmail.fr

**********************************/
?>
<?php if($_SESSION['level'] >= $levelNEWS) { ?>
<center><img src="<?php echo $ban_admin ; ?>"></center>
	
	<img style="background-color:#2f2f2f" src="style/img/topContent.png">
		<div id="bgContent">
			<div id="textContent">		

<?php
$errorNEWS = FALSE;
$okNEWS = FALSE;
$okMSGNEWS = FALSE;
$NEWSauteur = "";
$NEWStitre = "";
$NEWSnews = "";
$NEWStype = "";
date_default_timezone_set('America/Montreal');
/*FIN*/

	 if(isset($_GET['add']))
		{
	 $formulaireNEWS = TRUE;
	 
	 if (isset($_POST['NEWSgo']) && $_POST['NEWSgo']=='Poster la news') {
	 
	 $NEWSauteur = $_POST['NEWSauteur'];
	 $NEWStitre = $_POST['NEWStitre'];
	 $NEWSnews = $_POST['NEWSnews'];
	 $NEWStype = $_POST['NEWStype'];

	if (!isset($_POST['NEWSauteur']) || !isset($_POST['NEWStitre']) || !isset($_POST['NEWSnews'])) {
		$errorNEWS = TRUE;
		$erreurMSG = '<div class="verifNO"><img class="devtoolIcon" src="style/img/devtool/error.png"> Utilisez le formulatire ci-dessous pour ajouter une news !</div>';
	}
	else {
		if (empty($_POST['NEWSauteur']) || empty($_POST['NEWStitre']) || empty($_POST['NEWSnews'])) {
			$errorNEWS = TRUE;
			$erreurMSG = '<div class="verifNO"><img class="devtoolIcon" src="style/img/devtool/error.png"> Veuillez de remplir tout les champs !</div>';
		}
		// si tout est bon, on peut commencer l'insertion dans la base
		else {
			// lancement de la requête d'insertion
			$sql = 'INSERT INTO byxx_news VALUES("", "'.mysql_escape_string($_POST['NEWSauteur']).'", "'.mysql_escape_string($_POST['NEWStitre']).'", "'.date("Y-m-d H:i:s").'", "'.mysql_escape_string($_POST['NEWSnews']).'", "'.mysql_escape_string($_POST['NEWStype']).'")';

			// on lance la requête (mysql_query) et on impose un message d'erreur si la requête ne se passe pas bien (or die)
			mysql_query($sql) or die('Erreur SQL !'.$sql.'<br />'.mysql_error());
			$okNEWS = TRUE;
			$okMSGNEWS = '<div class="verifOK"><img class="devtoolIcon" src="style/img/devtool/infos.png"> Tu viens de publier une news !</div>';
			$formulaireNEWS = NULL;
		}
	}
}
	 
	  }
	  
	  if (isset($_GET['del'])) // Si on demande de supprimer une news
{

    $_GET['del'] = secu($_GET['del']);
    mysql_query('DELETE FROM byxx_news WHERE id=\'' . $_GET['del'] . '\'');
	echo ("<div class='verifOK'><img class='devtoolIcon' src='style/img/devtool/infos.png'> La suppression est un succes !</div>");
}	
?>
<?php if($errorNEWS == TRUE) { echo '' .  $erreurMSG . ''; } ?>
<?php if($okNEWS == TRUE) { echo '' .  $okMSGNEWS . ''; } ?>
<form action="<?php echo $lien_gnews ; ?>&amp;add" method="post" name="formulaire">
<table style="width: 85%;margin:auto;" border="0">
<br>
 <tr>
 <td>
 <span>Auteur :</span>
 </td>
<td>
 <input class="input" type="text" name="NEWSauteur">
</td>
 </tr>
 <tr>
 <td>
 <span>Titre :</span>
 </td>
 <td>
 <input class="input" type="text" name="NEWStitre">
 </td>
 <tr>
 <td>
 <span>Type :</span>
 </td>
 <td>
<select class="input" name="NEWStype">
  <option label="Information" value="1">Information</option>
  <option label="Annonce" value="2">Annonce</option>
  <option label="News" value="3">News</option>
</select>
 </td>
  </tr>
 </tr>
 <tr>
 </tr><tr><td>
  <span>News :</span><br><br>
 <fieldset><legend>Mise en forme</legend>
<center><input class="input" type="button" id="gras" name="gras" value="Gras" onClick="javascript:bbcode('[g]', '[/g]');return(false)" />
<input class="input" type="button" id="italic" name="italic" value="Italic" onClick="javascript:bbcode('[i]', '[/i]');return(false)" />
<input class="input" type="button" id="souligné" name="souligné" value="Souligné" onClick="javascript:bbcode('[s]', '[/s]');return(false)" />
<br /><br />
<img src="style/img/devtool/emots/1.png" class="devtoolIcon" title="heureux" alt="heureux" onClick="javascript:smilies(' :D ');return(false)" />
<img src="style/img/devtool/emots/2.png" class="devtoolIcon" title="lol" alt="lol" onClick="javascript:smilies(' :lol: ');return(false)" />
<img src="style/img/devtool/emots/3.png" class="devtoolIcon" title="triste" alt="triste" onClick="javascript:smilies(' :triste: ');return(false)" />
<img src="style/img/devtool/emots/4.png" class="devtoolIcon" title="cool" alt="cool" onClick="javascript:smilies(' :frime: ');return(false)" />
<img src="style/img/devtool/emots/5.png" class="devtoolIcon" title="rire" alt="rire" onClick="javascript:smilies(' :rire: ');return(false)" />
<img src="style/img/devtool/emots/6.png" class="devtoolIcon" title="confus" alt="confus" onClick="javascript:smilies(' :s ');return(false)" />
</center></fieldset>
 </td><td>
 <textarea id="message" style="width:270px;height: 150px;" class="input" name="NEWSnews" ></textarea>
 </td></tr><tr><td><td align="right">
 <input class="input" type="submit" name="NEWSgo" value="Poster la news">
 </td></tr>
 </table>
 </form>	
 
 						
			</div>
		</div>
	<img style="background-color:#2f2f2f" src="style/img/bottomContent.png">
	
	<img style="background-color:#2f2f2f" src="style/img/topContent.png">
		<div id="bgContent">
			<div id="textContent">	
 
 <center>
<table style="width: 95%" border="0">
<tr>
<th style='width: 50%'>Titre</th>
<th>Auteur</th>
<th style='width: 20%'>Date</th>
<th style='width: 16px'></th>
</tr>
<?php
$retour = mysql_query('SELECT * FROM byxx_news ORDER BY id DESC');
while ($donnees = mysql_fetch_array($retour))
{
?>
<tr>
<td><?php echo stripslashes(trim($donnees['titre'])); ?></td>
<td><?php echo stripslashes(trim($donnees['auteur'])); ?></td>
<td><?php sscanf($donnees['date'], "%4s-%2s-%2s %2s:%2s:%2s", $an, $mois, $jour, $heure, $min, $sec); echo $jour.'-'.$mois.'-'.$an.''; ?></td>
<td style='width: 16px'><?php echo '<a href='.$lien_gnews.'&amp;del=' . $donnees['id'] . '">'; ?><img title="Supprimer cette news" src="style/img/devtool/delete.png" class="devtoolIcon" ></a></td>
</tr>
<?php
} // Fin de la boucle qui liste les news
?>
</table>
</center>
						
			</div>
		</div>
	<img style="background-color:#2f2f2f" src="style/img/bottomContent.png">
<?php
} 
	else
{
?>	
<meta http-equiv="refresh" content="0; URL=<?php echo $lien_440 ; ?>">
<?php } ?>	